<!DOCTYPE html>
<html>
<head>
<title>Billing - PharmaFlow</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  .bill-invoice {
    background: white;
    border: 1px solid #ccc;
    padding: 20px;
    border-radius: 8px;
    margin-top: 10px;
    display: none;
  }
  .bill-invoice.show {
    display: block;
  }
  @media print {
    .bill-invoice { display: block !important; }
    .primary-btn, #cart, #billSearch, h3 { display: none; }
  }
</style>
</head>

<body>
<div class="layout">

<aside class="sidebar">
  <div class="brand">PharmaFlow</div>
  <nav>
    <a href="dashboard.html">Dashboard</a>
    <a class="active">Billing</a>
    <a href="index.html" onclick="logout();return false;">Logout</a>
  </nav>
</aside>

<main class="main">
  <div class="topbar">
    <h2>üí≥ Billing System</h2>
    <div class="user-card">
      <span id="staffName">üë§ Staff</span>
    </div>
  </div>

  <div style="display:grid; grid-template-columns:2fr 1fr; gap:20px;">
    
    <!-- LEFT: CART -->
    <div class="panel">
      <h3>Shopping Cart</h3>
      
      <div style="margin-bottom:15px;">
        <input id="billSearch" placeholder="Search medicine name" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;">
        <button onclick="searchMedBilling()" class="primary-btn" style="margin-top:8px; width:100%;">Add Medicine</button>
      </div>

      <div id="cart">
        <p style="color:#999; text-align:center; padding:20px;">Cart is empty</p>
      </div>

      <button onclick="checkout()" class="primary-btn" style="width:100%; padding:12px; margin-top:10px;">Generate Bill</button>

      <!-- BILL INVOICE -->
      <div id="billInvoice" class="bill-invoice">
        <div style="text-align:center; margin-bottom:20px; border-bottom:2px solid #2563eb; padding-bottom:10px;">
          <h2 style="margin:0;">PharmaFlow</h2>
          <p style="margin:5px 0; color:#666;">Professional Medicine Management System</p>
          <p style="margin:5px 0; font-size:0.9em; color:#999;">Bill Receipt</p>
        </div>

        <div id="billDetailsContent" style="font-size:0.95em; line-height:1.6;">
          <!-- Bill details will be inserted here -->
        </div>

        <div style="margin-top:20px; border-top:1px solid #ddd; padding-top:10px; text-align:center;">
          <button onclick="printBill()" class="primary-btn" style="margin:5px;">üñ®Ô∏è Print Bill</button>
          <button onclick="closeBill()" class="primary-btn" style="background:#666; margin:5px;">‚úï Close</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: BILL SUMMARY -->
    <div class="panel">
      <h3>Bill Summary</h3>
      <div id="billSummary" style="padding:15px; border:1px solid #e5e7eb; border-radius:8px; background:#f9fafb;">
        <p style="color:#999; text-align:center;">Cart summary appears here</p>
      </div>
      <div id="billMsg" style="margin-top:15px; padding:10px; border-radius:5px; display:none;"></div>
    </div>

  </div>

</main>

</div>

<script src="script.js"></script>
<script>
let currentUser = null;

document.addEventListener("DOMContentLoaded", () => {
  currentUser = verifyRole("staff");
  if (!currentUser) return;
  
  document.getElementById("staffName").innerText = currentUser.name || "Staff";
  updateCartDisplay();
  updateBillSummary();
});

function updateBillSummary() {
  const summary = document.getElementById("billSummary");
  const items = Object.values(billingCart);
  
  let total = 0;
  let itemCount = 0;
  
  items.forEach(item => {
    const itemTotal = item.price * item.quantity;
    total += itemTotal;
    itemCount += item.quantity;
  });
  
  summary.innerHTML = `
    <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid #e5e7eb;">
      <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
        <span>Items:</span>
        <span style="font-weight:bold;">${itemCount}</span>
      </div>
      <div style="display:flex; justify-content:space-between;">
        <span>Subtotal:</span>
        <span style="font-weight:bold;">‚Çπ${total.toFixed(2)}</span>
      </div>
    </div>
    <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.2em;">
      <span>Total:</span>
      <span style="color:#2563eb;">‚Çπ${total.toFixed(2)}</span>
    </div>
  `;
}

// Override the existing updateCartDisplay to also update summary
const originalUpdateCartDisplay = updateCartDisplay;
updateCartDisplay = function() {
  originalUpdateCartDisplay();
  updateBillSummary();
};
</script>

</body>
</html>